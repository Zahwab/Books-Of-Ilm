<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Books of Ilm – PDF Library</title>
  <style>
/*─────────────────────────────────────────────────────────────────────────────*/
/* 0. IMPORT & ROOT VARIABLES                                                 */
/*─────────────────────────────────────────────────────────────────────────────*/
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

:root {
  --bg: #fafafa;
  --fg: #1a1a1a;
  --muted: #4a4a4a;
  --surface: #ffffff;
  --border: #d8d8d8;
  --primary: #00796b;
  --accent: #ff8f00;
  --alt: #f1fcfb;
  --hamburger-line: #4af;
  --hamburger-border: #333;
  --shadow-light: rgba(0, 0, 0, 0.08);
  --shadow-darkmode: rgba(0, 255, 255, 0.2);
  --shadow-hover: rgba(0, 0, 0, 0.15);
  --transition: 0.3s ease;
}

body.dark {
  --bg: #121212;
  --fg: #eaeaea;
  --muted: #b0b0b0;
  --surface: #1e1e1e;
  --border: #2c2c2c;
  --primary: #26c6da;
  --accent: #ffb956;
  --alt: #181818;
}

/*─────────────────────────────────────────────────────────────────────────────*/
/* 1. RESET & BASE                                                            */
/*─────────────────────────────────────────────────────────────────────────────*/
*,
*::before,
*::after {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  background: var(--bg);
  color: var(--fg);
  font: clamp(16px, 1.8vw, 18px)/1.6 'Inter', sans-serif;
  letter-spacing: 0.3px;
  transition: background var(--transition), color var(--transition);
}

::selection {
  background: var(--accent);
  color: var(--surface);
}

h1, h2, h3, h4 {
  color: var(--fg);
  font-weight: 600;
  letter-spacing: 0.5px;
  margin-bottom: 0.5em;
}

h1 { font-size: 2.8rem; }
h2 { font-size: 2.2rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.25rem; }

p, ul, ol, li, label {
  margin-bottom: 1em;
  color: var(--fg);
}

a {
  color: var(--primary);
  text-decoration: none;
  font-weight: 500;
  transition: color 0.2s;
}

a:hover,
a:focus {
  color: var(--accent);
  outline: 2px dotted var(--accent);
}

/*─────────────────────────────────────────────────────────────────────────────*/
/* 2. LAYOUT CONTAINERS                                                       */
/*─────────────────────────────────────────────────────────────────────────────*/
.container {
  max-width: 1200px;
  width: 90%;
  margin: 0 auto;
  padding: 3em 0;
}

.alt {
  background: var(--alt);
  border-radius: 12px;
}

/*─────────────────────────────────────────────────────────────────────────────*/
/* 3. NAVBAR & DROPDOWNS                                                      */
/*─────────────────────────────────────────────────────────────────────────────*/
.sticky {
  position: sticky;
  top: 0;
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: rgba(255, 255, 255, 0.95);
  -webkit-backdrop-filter: blur(6px);
          backdrop-filter: blur(6px);
  padding: 1em 2%;
  box-shadow: 0 2px 6px var(--shadow-light);
  z-index: 1000;
  border-radius: 0 0 12px 12px;
}

body.dark .sticky {
  background: rgba(18, 18, 18, 0.95);
}

.logo {
  font-size: 1.5em;
  color: var(--primary);
  font-weight: 600;
}

.menu {
  list-style: none;
  display: flex;
  gap: 1.5em;
}

.menu a {
  padding: 0.2em;
  color: var(--fg);
}

.menu a:hover,
.menu a:focus {
  color: var(--primary);
  outline: 2px dotted var(--primary);
}

.has-sub {
  position: relative;
}

.submenu {
  display: none;
  position: absolute;
  top: 100%;
  left: 0;
  background: var(--surface);
  border: 1px solid var(--border);
  list-style: none;
  padding: 0.5em 0;
  border-radius: 0 0 8px 8px;
}

.has-sub:hover .submenu,
.has-sub:focus-within .submenu {
  display: block;
}

/*─────────────────────────────────────────────────────────────────────────────*/
/* 4. HAMBURGER MENU                                                          */
/*─────────────────────────────────────────────────────────────────────────────*/
.hamburger {
  display: none;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  width: 36px;
  height: 36px;
  padding: 6px;
  border: none;
  background: rgba(255, 255, 255, 0.85);
  border-radius: 8px;
  cursor: pointer;
  transition: transform var(--transition), background var(--transition);
  position: absolute;
  top: 1rem;
  right: 1rem;
  z-index: 1100;
  box-shadow: 0 4px 12px var(--shadow-light);
  -webkit-backdrop-filter: blur(6px);
          backdrop-filter: blur(6px);
}

.hamburger:active {
  transform: scale(0.95);
}

.hamburger span {
  display: block;
  width: 100%;
  height: 5px;
  background: var(--hamburger-line);
  border: 2px solid var(--hamburger-border);
  box-shadow: 2px 2px 0 var(--hamburger-border);
  margin: 4px 0;
  transition: transform 0.4s ease, opacity 0.3s ease;
  animation: pixelBounce 1.5s infinite ease-in-out;
}

.hamburger.active span:nth-child(1) {
  transform: translateY(9px) rotate(45deg);
}
.hamburger.active span:nth-child(2) {
  opacity: 0;
}
.hamburger.active span:nth-child(3) {
  transform: translateY(-9px) rotate(-45deg);
}

body.dark .hamburger {
  background: rgba(20, 20, 20, 0.9);
  box-shadow: 0 0 10px var(--shadow-darkmode);
}

/*─────────────────────────────────────────────────────────────────────────────*/
/* 5. HERO & CTA                                                               */
/*─────────────────────────────────────────────────────────────────────────────*/
.hero {
  position: relative;
  background: linear-gradient(135deg, var(--primary), var(--accent));
  color: var(--surface);
  height: 60vh;
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  padding: 0 1em;
  border-radius: 12px;
}

.hero h1 {
  font-size: 3rem;
  margin-bottom: 0.5em;
}
.hero p {
  font-size: 1.2rem;
}
.btn-cta {
  margin-top: 1em;
  background: var(--surface);
  color: var(--primary);
  padding: 0.75em 1.5em;
  border-radius: 10px;
  font-weight: 600;
  position: relative;
  overflow: hidden;
  transition: transform 0.2s, box-shadow 0.2s;
}
.btn-cta:hover,
.btn-cta:focus {
  transform: scale(1.05);
  box-shadow: 0 6px 16px var(--shadow-hover);
  outline: 2px solid var(--accent);
}

/*─────────────────────────────────────────────────────────────────────────────*/
/* 6. SECTION HEADERS                                                          */
/*─────────────────────────────────────────────────────────────────────────────*/
.section-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1em;
}

.section-header h2 {
  position: relative;
  font-size: 2rem;
  font-weight: 600;
}

.section-header h2::after {
  content: '';
  position: absolute;
  left: 0;
  bottom: -6px;
  width: 50px;
  height: 3px;
  background: var(--accent);
  transition: width var(--transition);
}
.section-header h2:hover::after,
.section-header h2:focus-within::after {
  width: 100px;
}

/*─────────────────────────────────────────────────────────────────────────────*/
/* 7. GRIDS, CARDS & WIDGETS                                                   */
/*─────────────────────────────────────────────────────────────────────────────*/
.grid,
.tools-grid,
.donate-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  gap: 1.5em;
}

.card,
.widget,
.donate-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 1.5em;
  box-shadow: 0 4px 12px var(--shadow-light);
  opacity: 0;
  transform: translateY(20px);
  transition: opacity 0.6s ease-out, transform 0.6s ease-out, box-shadow 0.2s ease;
}

.card.visible,
.widget.visible,
.donate-card.visible {
  opacity: 1;
  transform: translateY(0);
}

.card:hover,
.card:focus-within,
.widget:hover,
.widget:focus-within,
.donate-card:hover,
.donate-card:focus-within {
  transform: translateY(-5px);
  box-shadow: 0 8px 20px var(--shadow-hover);
}

.card h3,
.widget h3,
.donate-card h3 {
  margin-bottom: 0.8em;
  color: var(--fg);
}

.card p {
  font-size: 0.95rem;
}

.card .btn {
  display: inline-block;
  margin-top: 1em;
  background: var(--primary);
  color: var(--surface);
  padding: 0.6em 1.2em;
  border-radius: 10px;
  font-weight: 500;
  transition: background 0.2s, box-shadow 0.2s;
}
.card .btn:hover,
.card .btn:focus {
  background: var(--accent);
  box-shadow: 0 4px 12px var(--shadow-hover);
  outline: 2px solid var(--accent);
}

.card img {
  max-width: 100%;
  height: auto;
  border-radius: 8px;
  margin-bottom: 1em;
}

/*─────────────────────────────────────────────────────────────────────────────*/
/* 8. DONATE SECTION                                                           */
/*─────────────────────────────────────────────────────────────────────────────*/
.donate-section {
  background: var(--primary);
  color: var(--surface);
  text-align: center;
  padding: 3em 0;
  border-radius: 12px;
}

.donate-card img.qr {
  display: block;
  margin: 1em auto;
  width: 120px;
}

.donate-card ul {
  list-style: none;
  padding: 0;
  color: var(--surface);
}

.donate-card ul li {
  margin-bottom: 0.5em;
  font-size: 0.95rem;
}

/*─────────────────────────────────────────────────────────────────────────────*/
/* 9. FLOATING ACTION BUTTONS                                                  */
/*─────────────────────────────────────────────────────────────────────────────*/
.floating-feedback,
.floating-top {
  position: fixed;
  right: 20px;
  border: none;
  border-radius: 50%;
  background: var(--accent);
  color: var(--fg);
  padding: 0.8em;
  font-size: 1.4em;
  box-shadow: 0 4px 12px var(--shadow-light);
  cursor: pointer;
  transition: background 0.2s, transform 0.2s;
  display: none;
}
.floating-feedback:hover,
.floating-feedback:focus,
.floating-top:hover,
.floating-top:focus {
  background: var(--primary);
  transform: scale(1.1);
  outline: 2px solid var(--accent);
}

/*─────────────────────────────────────────────────────────────────────────────*/
/* 10. MODAL & RIPPLE EFFECT                                                   */
/*─────────────────────────────────────────────────────────────────────────────*/
.modal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.6);
  align-items: center;
  justify-content: center;
  padding: 1em;
  z-index: 2000;
}

.modal-content {
  background: var(--surface);
  padding: 2em;
  border-radius: 12px;
  max-width: 400px;
  width: 100%;
  position: relative;
  color: var(--fg);
}

.close-btn {
  position: absolute;
  top: 0.5em;
  right: 0.5em;
  font-size: 1.5em;
  cursor: pointer;
}

.btn {
  position: relative;
  overflow: hidden;
}

.btn .ripple {
  position: absolute;
  width: 80px;
  height: 80px;
  background: rgba(255, 255, 255, 0.4);
  border-radius: 50%;
  transform: scale(0);
  animation: ripple 0.6s ease-out;
}

@keyframes ripple {
  to {
    transform: scale(4);
    opacity: 0;
  }
}

@keyframes pixelBounce {
  0%, 100% { transform: translateY(0); }
  50%       { transform: translateY(-3px); }
}

/*─────────────────────────────────────────────────────────────────────────────*/
/* 11. FOOTER                                                                  */
/*─────────────────────────────────────────────────────────────────────────────*/
footer {
  text-align: center;
  padding: 2em 0;
  color: var(--muted);
  border-radius: 0 0 12px 12px;
}

/*─────────────────────────────────────────────────────────────────────────────*/
/* 12. RESPONSIVE ADJUSTMENTS                                                  */
/*─────────────────────────────────────────────────────────────────────────────*/
@media (max-width: 1024px) {
  .hero h1 { font-size: 2.5rem; }
}

@media (max-width: 768px) {
  .hamburger {
    display: flex;
  }
  .sticky {
    position: relative;
  }
  .menu {
    position: fixed;
    top: 0;
    right: 0;
    height: 100vh;
    width: 70%;
    max-width: 320px;
    background: var(--surface);
    -webkit-backdrop-filter: blur(6px);
            backdrop-filter: blur(6px);
    box-shadow: -4px 0 12px var(--shadow-light);
    flex-direction: column;
    transform: translateX(100%);
    transition: transform var(--transition) ease-out;
    padding: 2em 1.5em;
    gap: 1em;
    z-index: 1000;
  }
  body.dark .menu {
    background: rgba(18, 18, 18, 0.95);
  }
  .menu.open {
    transform: translateX(0);
  }
  .menu a {
    padding: 1em 0;
    color: var(--fg);
  }
  .donate-grid,
  .grid,
  .tools-grid {
    grid-template-columns: 1fr;
  }
}

/*─────────────────────────────────────────────────────────────────────────────*/
/* 13. BODY SCROLL LOCK WHEN MENU IS OPEN                                      */
/*─────────────────────────────────────────────────────────────────────────────*/
body.menu-open {
  overflow: hidden;
}

  </style>
</head>


 <body>
  <!-- Sticky Navbar -->
  <header class="sticky">
    <div class="logo">Books of Ilm</div>

    <nav>
      <ul class="menu">
        <li><a href="#hero">Home</a></li>
        <li class="has-sub">
          <a href="#">Library ▼</a>
          <ul class="submenu">
            <li><a href="#featured">Featured</a></li>
            <li><a href="knowledge.html">All Books</a></li>
          </ul>
        </li>
        <li><a href="#tools">Tools</a></li>
        <li><a href="#latest">Latest Uploads</a></li>
        <li><a href="#donate">Donate</a></li>
      </ul>
    </nav>

    <div class="utility">
      <select id="langSwitch">
        <option value="en">EN</option>
        <option value="ar">AR</option>
        <option value="bn">BN</option>
      </select>
      <button id="darkToggle" title="Toggle dark mode">🌙</button>
    </div>

    <!-- Animated Pixel Hamburger -->
    <button id="hamburgerBtn" class="hamburger" aria-label="Toggle menu">
      <span></span>
      <span></span>
      <span></span>
    </button>
  </header>

  <!-- Hero Section -->
  <section id="hero" class="hero">
    <div class="hero-content container">
      <h1>Books of Ilm</h1>
      <p>Your free PDF library of authentic Islamic knowledge.</p>
      <a href="#featured" class="btn btn-cta">Browse Featured</a>
    </div>
  </section>

  <!-- Featured Books -->
  <section id="featured" class="grid-section container alt">
    <div class="section-header">
      <h2>📚 Featured Books</h2>
      <button id="refreshFeatured" title="Refresh list">🔄</button>
    </div>
    <div class="grid" id="featuredGrid"></div>
  </section>

  <!-- Tools Section -->
  <section id="tools" class="grid-section container">
    <div class="section-header">
      <h2>🕰️ Prayer & Tools</h2>
    </div>
    <div class="tools-grid">
      <div class="widget prayer">
        <h3>Prayer Times</h3>
        <label for="calcMethod">Method</label>
        <select id="calcMethod">
          <option value="8">Umm al-Qura</option>
          <option value="5">Karachi</option>
        </select>
        <ul id="prayerList"></ul>
      </div>
      <div class="widget hijri">
        <h3>Hijri Date</h3>
        <div id="hijriDate">Loading…</div>
      </div>
      <div class="widget qibla">
        <h3>Qibla Direction</h3>
        <div id="compass">Loading…</div>
      </div>
      <div class="widget converter">
        <h3>Date Converter</h3>
        <input type="date" id="greg" />
        <button id="convertBtn" class="btn">Convert</button>
        <div id="converted"></div>
      </div>
    </div>
  </section>

  <!-- Latest Uploads -->
  <section id="latest" class="grid-section container alt">
    <div class="section-header">
      <h2>🆕 Latest Uploads</h2>
    </div>
    <div class="grid" id="latestGrid"></div>
    <button id="showMoreLatest" class="btn btn-center">Show More</button>
  </section>

  <!-- Donate Section -->
  <section id="donate" class="donate-section container">
    <h2>💖 Support Us</h2>
    <p>Your donations keep these books free and accessible. Choose any method:</p>
    <div class="donate-grid">
      <div class="donate-card paypal">
        <img src="images/paypal.svg" alt="PayPal" />
        <h3>PayPal</h3>
        <a href="https://www.paypal.com/donate?hosted_button_id=YOUR_ID" target="_blank" class="btn">
          Donate via PayPal
        </a>
      </div>
      <div class="donate-card stripe">
        <img src="images/credit-card.svg" alt="Card" />
        <h3>Credit / Debit Card</h3>
        <button id="stripeBtn" class="btn">Donate with Card</button>
      </div>
      <div class="donate-card upi">
        <img src="images/upi.svg" alt="UPI" />
        <h3>UPI (India)</h3>
        <img src="images/upi-qr.png" alt="Scan UPI" class="qr" />
        <p>Scan with Google Pay, PhonePe, etc.</p>
      </div>
      <div class="donate-card bank">
        <img src="images/bank.svg" alt="Bank" />
        <h3>Bank Transfer</h3>
        <ul>
          <li><strong>Account:</strong> Books of Ilm</li>
          <li><strong>No:</strong> 1234567890</li>
          <li><strong>IFSC:</strong> ABCD0123456</li>
          <li><strong>Bank:</strong> Your Bank Name</li>
        </ul>
      </div>
    </div>
  </section>

  <!-- Floating Buttons -->
  <button id="feedbackBtn" class="floating-feedback" title="Report Issue / Request Book">📝</button>
  <button id="backToTop" class="floating-top" title="Back to Top">↑</button>

  <!-- Footer -->
  <footer class="container">
    <p>&copy; 2025 Books of Ilm. All rights reserved.</p>
  </footer>
  <script src="https://js.stripe.com/v3/"></script>
<script>
(function() {
  // A) DARK MODE MEMORY
  const darkToggle = document.getElementById('darkToggle');
  if (darkToggle) {
    const isDark = localStorage.getItem('dark') === 'true';
    document.body.classList.toggle('dark', isDark);
    darkToggle.setAttribute('aria-pressed', isDark);
    darkToggle.addEventListener('click', () => {
      const darkModeOn = document.body.classList.toggle('dark');
      localStorage.setItem('dark', darkModeOn);
      darkToggle.setAttribute('aria-pressed', darkModeOn);
    });
  }

  // B) LANGUAGE SWITCH & DIRECTION
  const langSwitch = document.getElementById('langSwitch');
  if (langSwitch) {
    langSwitch.addEventListener('change', () => {
      const lang = langSwitch.value;
      document.documentElement.lang = lang;
      document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
    });
  }

  // C) BACK TO TOP & FEEDBACK BUTTON
  const backToTop = document.getElementById('backToTop');
  const feedbackBtn = document.getElementById('feedbackBtn');
  if (backToTop || feedbackBtn) {
    window.addEventListener('scroll', () => {
      const show = window.scrollY > 400;
      if (backToTop)    backToTop.style.display    = show ? 'block' : 'none';
      if (feedbackBtn)  feedbackBtn.style.display  = show ? 'block' : 'none';
    });
    if (backToTop) backToTop.addEventListener('click', () => {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });
    if (feedbackBtn) feedbackBtn.addEventListener('click', () => {
      window.location.href = '/contact.html';
    });
  }

  // D) HAMBURGER MENU TOGGLE
  const hamburger = document.querySelector('.hamburger');
  const menu      = document.querySelector('.menu');
  if (hamburger && menu) {
    hamburger.setAttribute('aria-expanded', 'false');
    hamburger.setAttribute('aria-label', 'Toggle menu');
    hamburger.addEventListener('click', () => {
      const open = hamburger.classList.toggle('open');
      menu.classList.toggle('open');
      hamburger.setAttribute('aria-expanded', open);
      document.body.classList.toggle('menu-open', open);
    });
  }

  // IntersectionObserver for on-scroll fade-in
  const observer = new IntersectionObserver((entries, obs) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add('visible');
        obs.unobserve(entry.target);
      }
    });
  }, { threshold: 0.1 });

  // G) CARD CREATION UTILITY
  function createCard(book, container) {
    const card = document.createElement('div');
    card.className = 'card';
    card.innerHTML = `
      <img loading="lazy" src="${book.cover}" alt="${book.title}">
      <h3>${book.title}</h3>
      <p>${book.desc}</p>
      <a href="pdfs/${book.file}" class="btn" download>Download PDF</a>
    `;
    container.appendChild(card);
    observer.observe(card);
  }

  // E) FEATURED BOOKS WITH REFRESH
  const allFeatured = [
    { cover: 'covers/quran_management.jpg',    title: 'Quran & Management',    file: 'quran_management.pdf',    desc: 'Management lessons from the Quran.' },
    { cover: 'covers/tafsir_insights.jpg',     title: 'Tafsir Insights',       file: 'tafsir_insights.pdf',      desc: 'Deep exegesis of key verses.' },
    { cover: 'covers/islamic_history.jpg',     title: 'Islamic History',       file: 'islamic_history.pdf',      desc: 'From the Prophet’s era onward.' },
    { cover: 'covers/fiqh_simplified.jpg',     title: 'Fiqh Simplified',        file: 'fiqh_simplified.pdf',      desc: 'Everyday rulings made easy.' },
    { cover: 'covers/spiritual_practices.jpg', title: 'Spiritual Practices',    file: 'spiritual_practices.pdf',  desc: 'Daily routines for heart.' },
    { cover: 'covers/prophetic_character.jpg', title: 'Prophetic Character',    file: 'prophetic_character.pdf',  desc: 'Manners of the Prophet.' }
  ];
  const featuredGrid = document.getElementById('featuredGrid');
  const refreshBtn   = document.getElementById('refreshFeatured');

  function renderFeatured(count = 4) {
    if (!featuredGrid) return;
    featuredGrid.innerHTML = '';
    allFeatured
      .slice()
      .sort(() => Math.random() - 0.5)
      .slice(0, count)
      .forEach(book => createCard(book, featuredGrid));
  }

  if (refreshBtn) refreshBtn.addEventListener('click', () => renderFeatured());
  renderFeatured();

  // F) LATEST UPLOADS WITH BATCHING
  const latestUploads = [
    { cover: 'uploads/book1.jpg', title: 'New Tafsir Release',   file: 'new_tafsir.pdf', desc: 'Makki verses commentary.' },
    { cover: 'uploads/book2.jpg', title: 'Modern Fiqh Guide',    file: 'modern_fiqh.pdf', desc: 'Fiqh for today’s challenges.' },
    { cover: 'uploads/book3.jpg', title: 'Islamic Finance',      file: 'islamic_finance.pdf', desc: 'Shariah-compliant principles.' },
    { cover: 'uploads/book4.jpg', title: 'Sufi Insights',        file: 'sufi_insights.pdf', desc: 'Inner dimensions of worship.' },
    { cover: 'uploads/book5.jpg', title: 'Arabic Grammar',       file: 'arabic_grammar.pdf', desc: 'Classical Arabic rules.' },
    { cover: 'uploads/book6.jpg', title: 'Ethics in Islam',      file: 'ethics.pdf', desc: 'Moral conduct in Islam.' }
  ];
  let latestIndex = 0, perBatch = 4;
  const latestGrid   = document.getElementById('latestGrid');
  const showMoreBtn  = document.getElementById('showMoreLatest');

  function loadLatest() {
    if (!latestGrid) return;
    latestUploads
      .slice(latestIndex, latestIndex + perBatch)
      .forEach(book => createCard(book, latestGrid));
    latestIndex += perBatch;
    if (latestIndex >= latestUploads.length && showMoreBtn) {
      showMoreBtn.style.display = 'none';
    }
  }

  if (showMoreBtn) {
    showMoreBtn.addEventListener('click', loadLatest);
    loadLatest();
  }

  // Observe footer fade-in
  const footerEl = document.querySelector('footer');
  if (footerEl) observer.observe(footerEl);

  // I) SMOOTH SCROLL FOR INTERNAL LINKS
  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', e => {
      e.preventDefault();
      const target = document.querySelector(anchor.getAttribute('href'));
      if (target) target.scrollIntoView({ behavior: 'smooth' });
    });
  });

  // J) GEOLOCATION → PRAYER, HIJRI & QIBLA VIA ALADHAN
  const prayerList = document.getElementById('prayerList');
  const hijriDate  = document.getElementById('hijriDate');
  const compass    = document.getElementById('compass');
  const calcMethod = document.getElementById('calcMethod');

  function getCalcMethod() {
    return calcMethod?.value || '2'; // default: Muslim World League
  }

  function loadPrayerHijri(lat, lng) {
    fetch(`https://api.aladhan.com/v1/timings?latitude=${lat}&longitude=${lng}&method=${getCalcMethod()}`)
      .then(res => res.json())
      .then(json => {
        const times = json.data.timings;
        const date  = json.data.date.hijri;
        if (prayerList) {
          prayerList.innerHTML = '';
          ['Fajr','Dhuhr','Asr','Maghrib','Isha'].forEach(name => {
            const li = document.createElement('li');
            li.textContent = `${name}: ${times[name]}`;
            prayerList.appendChild(li);
          });
        }
        if (hijriDate) {
          hijriDate.textContent = `${date.day} ${date.month.en} ${date.year}`;
        }
      })
      .catch(e => console.error('Aladhan error:', e));
  }

  function loadQibla(lat, lng) {
    fetch(`https://api.aladhan.com/v1/qibla/${lat}/${lng}`)
      .then(res => res.json())
      .then(json => {
        if (compass) {
          compass.textContent = `${json.data.direction.toFixed(1)}° from North`;
        }
      })
      .catch(e => console.error('Qibla API error:', e));
  }

  function onGeoSuccess({ coords: { latitude: lat, longitude: lng } }) {
    loadPrayerHijri(lat, lng);
    loadQibla(lat, lng);
  }

  function onGeoError(err) {
    console.warn('Geolocation failed:', err.message);
    // fallback to Makkah
    onGeoSuccess({ coords: { latitude: 21.422487, longitude: 39.826206 } });
  }

  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(onGeoSuccess, onGeoError, {
      enableHighAccuracy: true,
      timeout: 10000,
      maximumAge: 0
    });
    if (calcMethod) {
      calcMethod.addEventListener('change', () => {
        navigator.geolocation.getCurrentPosition(onGeoSuccess, onGeoError);
      });
    }
  } else {
    onGeoError(new Error('Geolocation not supported'));
  }

  // K) DATE CONVERTER
  const gregInput  = document.getElementById('greg');
  const convertBtn = document.getElementById('convertBtn');
  const converted  = document.getElementById('converted');

  if (convertBtn && gregInput && converted) {
    convertBtn.addEventListener('click', () => {
      const date = new Date(gregInput.value);
      if (isNaN(date)) {
        converted.textContent = 'Invalid date';
        return;
      }
      converted.textContent = new Intl.DateTimeFormat('en-u-ca-islamic', {
        day:   'numeric',
        month: 'long',
        year:  'numeric'
      }).format(date);
    });
  }

  // L) STRIPE CHECKOUT FOR CARD DONATIONS
  const stripeBtn = document.getElementById('stripeBtn');
  if (stripeBtn && window.Stripe) {
    const stripe = Stripe('pk_test_YOUR_PUBLISHABLE_KEY');
    stripeBtn.addEventListener('click', () => {
      fetch('/create-stripe-session', { method: 'POST' })
        .then(res => res.json())
        .then(data => stripe.redirectToCheckout({ sessionId: data.sessionId }))
        .catch(e => {
          console.error('Stripe error:', e);
          alert('Payment error. Please try again or contact support.');
        });
    });
  }

  // N) RIPPLE EFFECT ON ALL .btn
  document.querySelectorAll('.btn').forEach(btn => {
    btn.style.position = 'relative';
    btn.addEventListener('click', e => {
      const circle = document.createElement('span');
      circle.className = 'ripple';
      const rect = btn.getBoundingClientRect();
      circle.style.left = `${e.clientX - rect.left}px`;
      circle.style.top  = `${e.clientY - rect.top}px`;
      btn.appendChild(circle);
      setTimeout(() => circle.remove(), 600);
    });
  });
})();
</script>

</body>

</html>